"use client";

import { FC, useEffect, useState } from "react";
import toast from "react-hot-toast";
import { DisableFocus } from "../hooks/useInputFocus";
import { Overlay } from "./Overlay";

type Props = {
    setDisableFocus: DisableFocus;
    createUser: (name: string) => Promise<boolean>;
    id: string | undefined;
};

export const AddName: FC<Props> = ({ setDisableFocus, createUser, id }) => {
    const [isOpen, setIsOpen] = useState(() => !id);

    const [name, setName] = useState("");

    useEffect(() => {
        setDisableFocus(isOpen);
    }, [isOpen, setDisableFocus]);

    const submit = async () => {
        if (name.length === 0) {
            toast.error("Du m친ste ange ett namn");
            return;
        }

        const success = await createUser(name);

        if (!success) {
            toast.error("Namnet 칛r upptaget");
            return;
        }

        toast.success(`Nu k칬r vi, ${name}!`);

        setIsOpen(false);
    };

    return (
        <Overlay show={isOpen} close={() => setIsOpen(false)}>
            <div className="flex flex-col gap-4 mt-8">
                <div className="text-2xl font-bold uppercase">游꿀 Spela med v칛nner</div>
                <div className="mt-4 flex flex-col gap-4">
                    <div>
                        <div className="mb-1 text-xl font-bold">B칛st idag? 游끥</div>
                        <div className="text-gray-600 mt-4">
                            V칛lj ett passande namn och g친 in p친
                            <span className="font-bold text-primaryDark"> V칛nner</span> i menyn f칬r
                            att l칛gga till dina v칛nner och se vem som 칛r b칛st idag.
                        </div>
                        <div className="text-gray-600 mt-4">V칛lj ett unikt namn och k칬r ig친ng!</div>
                    </div>

                    <div>
                        <input
                            type="text"
                            className="w-full border-slate-800 border h-12 
                            rounded px-4 py-2 focus:outline-none 
                            focus:ring-2 focus:ring-slate-800 
                            focus:border-transparent
                            mt-8"
                            placeholder="Namn"
                            value={name}
                            onChange={e => setName(e.target.value)}
                            onKeyDown={async e => {
                                if (e.key === "Enter") {
                                    await submit();
                                }
                            }}
                        />
                        <button
                            className="w-full
                            bg-primary text-white 
                            font-bold uppercase rounded 
                            px-4 py-2 mt-4"
                            onClick={submit}
                        >
                            Spara
                        </button>
                    </div>
                </div>
            </div>
        </Overlay>
    );
};
